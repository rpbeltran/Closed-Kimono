<!DOCTYPE html>
<html lang="en">

<head>
    <!--Import Google Icon Font-->
    <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <script src = "../libraries/jquery-3.1.1.min.js" ></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.7/css/materialize.min.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.7/js/materialize.min.js"></script>

    <script src="card.js"> </script>

    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

</head>

<body>

<div id = "browser" >

</div>


<script type = "text/javascript" >

    function loadJSON(source, callback) {
        var xobj = new XMLHttpRequest();
        xobj.overrideMimeType( "application/json" );
        xobj.open('GET', source, true); // Replace 'my_data' with the path to your file
        xobj.onreadystatechange = function () {
            if (xobj.readyState == 4 && xobj.status == "200") {
                // Required use of an anonymous callback as .open will NOT return a value but simply returns undefined in asynchronous mode
                callback(xobj.responseText);
            }
        };
        xobj.send(null);
    }

    function getByValue(arr, value, search) {

        for (var i=0, iLen=arr.length; i<iLen; i++) {

            if (arr[i][value] == search) return arr[i];
        }
    }

    function drawCards( db, path ) {

        folder = db ;
        for ( var i = 0, l = path.length; i < l; i++ ) {
            folder = getByValue(folder.data, "name", path[i]);
        }

        if (path.length != 0) {
            folder.data.unshift( "back_button" );
        }

        var row = 0;
        $.each( folder.data, function (key, data) {
            if (key % 5 == 0) {
                row += 1;
                $('#browser').append( '<div class="row" id="row'+row.toString()+'">  </div>' );
            }

            if (data == "back_button") {
                $('#row' + row.toString() ).append( backCard( ) );
            } else {
                $('#row' + row.toString() ).append( jsonCard(data) );
            }

        });
    }

    function drawCardsFromJSON( source, path ) {

        loadJSON( source, function( response ) {

            var data = JSON.parse( response );
            drawCards( data, path );

            $(".authenticationist").click( function() {
                var value = $(this).attr("data");
                open(data, path, value);
            });

            $(".back_card .activator").click( function() {
                open(data, path, {"data":"back_button"});
            });

        });
    }

</script>

<script type = "text/javascript" >

    function open( db, path,  file ) {
        folder = db;
        for ( var i = 0, l = path.length; i < l; i++ ) {
            folder = getByValue(folder.data, "name", path[i]);
        }

        if (file.data == "back_button") {
          path.pop();            $('#browser').html("");

            drawCardsFromJSON( "database.json", path );
            return;
        }
        file = getByValue(folder.data, "name", file);

        if (file.type == "file" ) {
            alert("Opening " + file.name);
        } else {
            path.push(file.name);
            $('#browser').html("");
            drawCardsFromJSON( "database.json", path );
        }
    }

    drawCardsFromJSON( "database.json", [  ] );


</script>

</body>

</html>


